@page
@model RazorClassBlog.Areas.Blog.Pages.IndexModel
@using Microsoft.Extensions.Options
@using RazorClassBlog.Models
@inject IOptions<BlogOptions> Options
@{
  ViewData["Title"] = Options.Value.PublicDisplayName;
  ViewData["canonical"] = Url.Page("Index", null, new { area = "Blog" }, protocol: HttpContext.Request.Scheme);
  ViewData["Description"] = Options.Value.BlogDescription;
  ViewData["og:title"] = Options.Value.PublicDisplayName;
  ViewData["og:type"] = "website";
  ViewData["og:image"] = Options.Value.DefaultOrganizationImageURL;
  ViewData["og:url"] = ViewData["canonical"];
}

<nav aria-label="breadcrumb" class="mt-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a asp-page="/Index" asp-area="">Home</a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">@Options.Value.PublicDisplayName</li>
  </ol>
</nav>

<section class="mt-3 mb-4">
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
    <div>
      <h1 class="mb-1">@Options.Value.PublicDisplayName</h1>
      <p class="text-muted mb-0">
        @Options.Value.BlogDescription
      </p>
    </div>

    <form method="get" class="d-flex gap-2" role="search">
      <input type="hidden" name="PageNumber" value="1" />
      <input type="text" name="Search" value="@Model.Search" class="form-control" placeholder="Search posts..." />      
      <button class="btn btn-outline-secondary" type="submit">Search</button>
    </form>
  </div>
</section>

<div class="row">
  <div class="col-lg-8">
    @if (!Model.Posts.Items.Any())
    {
      <div class="alert alert-info">
        No posts found. Try a different search.
      </div>
    }
    else
    {
      <div class="row row-cols-1 g-4">
				@Html.DisplayFor(model => model.Posts.Items)
      </div>

      <nav class="mt-4 d-flex justify-content-between align-items-center" aria-label="@Options.Value.PublicDisplayName pagination">
        <div>
          Page @Model.Posts.Page of @Model.Posts.TotalPages
        </div>
        <div class="btn-group">
          @if (Model.Posts.HasPreviousPage)
          {
            <a asp-page="Index" asp-route-PageNumber="@(Model.Posts.Page - 1)" asp-route-Tag="@Model.Tag" asp-route-Search="@Model.Search" class="btn btn-outline-secondary">
              &laquo; Newer
            </a>
          }

          @if (Model.Posts.HasNextPage)
          {
            <a asp-page="Index" asp-route-PageNumber="@(Model.Posts.Page + 1)" asp-route-Tag="@Model.Tag" asp-route-Search="@Model.Search" class="btn btn-outline-secondary">
              Older &raquo;
            </a>
          }
        </div>
      </nav>
    }
  </div>

  <aside class="col-lg-4 mt-4 mt-lg-0">
    <div class="border rounded-3 p-3 mb-3 bg-light">
      @* added a check to see if the public display name ends with 's', if so we drop 'this' because it doesnt fit in english well, but this may not cover every case *@
      <h2 class="h5">About @(!Options.Value.PublicDisplayName.EndsWith("s") ? "this" : "") @Options.Value.PublicDisplayName</h2>
      <p class="mb-0 text-muted">
        @Html.Raw(Options.Value.BlogReason)
      </p>
    </div>
    <div class="border rounded-3 p-3 mb-3">
      <h2 class="h6 text-uppercase text-muted mb-2">Filter</h2>
      <form method="get" class="d-grid gap-2">
        <input type="hidden" name="PageNumber" value="1" />
        <div class="mb-2">
          <label class="form-label">Tag</label>
          <input type="text" name="Tag" value="@Model.Tag" class="form-control" placeholder="e.g. Updates" />
        </div>
        <button class="btn btn-outline-secondary btn-sm" type="submit">Apply</button>
      </form>
    </div>

    @* Later: add "Recent posts", "Popular tags", etc. *@
  </aside>
</div>