@page "{year:int}/{month:int}/{slug}"
@using Microsoft.Extensions.Options
@model RazorClassBlog.Areas.Blog.Pages.PostModel
@inject IOptions<BlogOptions> Options;
@{
  var post = Model.Post;
  if (post is not null)
  {
    ViewData["Title"] = post.Title;
    var published = (post.PublishedUtc ?? post.CreatedUtc);
    ViewData["canonical"] = Url.Page("Post", null, new { area = "Blog", year = published.Year, month = published.Month, slug = post.Slug }, protocol: HttpContext.Request.Scheme);
    ViewData["Description"] = string.IsNullOrWhiteSpace(post.Summary) ? (post.Content?.Length > 160 ? post.Content.Substring(0, 157) + "..." : post.Content) : post.Summary;
    ViewData["og:title"] = post.Title;
    ViewData["og:type"] = "article";
    ViewData["og:image"] = post.HeroImageUrl;
    ViewData["og:url"] = ViewData["canonical"];
  }
}

@if (post is null)
{
  <h1>Post not found</h1>
}
else
{
  var published = (post.PublishedUtc ?? post.CreatedUtc);

  <nav aria-label="breadcrumb" class="mt-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a asp-page="/Index" asp-area="">Home</a>
      </li>
      <li class="breadcrumb-item">
        <a asp-page="Index" asp-area="Blog">@Options.Value.PublicDisplayName</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        @post.Title
      </li>
    </ol>
  </nav>

  <article class="mt-3">
    <header class="mb-4">
      <h1 class="mb-2">@post.Title</h1>

      <p class="text-muted mb-2">
        @published.ToString("MMMM dd, yyyy")
        @if (!string.IsNullOrWhiteSpace(post.AuthorName))
        {
          <span> &middot; @post.AuthorName</span>
        }
      </p>

      @if (post.Tags?.Any() == true)
      {
        <div>
          @foreach (var tag in post.Tags)
          {
            <span class="badge rounded-pill text-bg-light me-1">@tag</span>
          }
        </div>
      }

      @if (!string.IsNullOrWhiteSpace(post.HeroImageUrl))
      {
        <figure class="blog-hero mb-3">
          <div class="ratio ratio-21x9 rounded-4 overflow-hidden shadow-sm">
            <img src="@post.HeroImageUrl" class="w-100 h-100" style="object-fit:cover;" alt="@post.Title" loading="lazy" decoding="async" />
          </div>
          <figcaption class="text-muted small mt-2">@post.Title</figcaption>
        </figure>
      }
    </header>

    <section class="blog-content lh-lg">
      @Html.Raw(post.Content)
    </section>

    <footer class="mt-5 pt-4 border-top">
      <a asp-page="Index" asp-area="Blog" class="btn btn-outline-secondary">
        &laquo; Back to @Options.Value.PublicDisplayName home
      </a>
    </footer>
  </article>

  @section Metas {
    <script type="application/ld+json">
      {
        "@@context": "https://schema.org",
        "@@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "@Url.Page("/Index", null, new { area = "" }, Request.Scheme)"
          },
          {
            "@@type": "ListItem",
            "position": 2,
            "name": "@Options.Value.PublicDisplayName",
            "item": "@Url.Page("Index", null, new { area = "Blog" }, protocol: Request.Scheme)"
          },
          {
            "@@type": "ListItem",
            "position": 3,
            "name": "@post.Title",
            "item": "@Url.Page("Post", null, new { area = "Blog", year = published.Year, month = published.Month, slug = post.Slug }, protocol: Request.Scheme)"
          }
        ]
      }
    </script>

    @await Html.PartialAsync("_BlogPostingJSONLDPartial", post)
   
  }
}